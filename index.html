<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCPorted ROMs Library</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aws-sdk/2.1502.0/aws-sdk.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>CCPorted ROMs Library</h1>
        <div id="content">
            <div class="loading">Loading ROMs...</div>
        </div>
    </div>

    <script>
        // AWS Configuration
        AWS.config.region = 'us-west-2';
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
            IdentityPoolId: 'us-west-2:cb7ff0d0-87c6-43c8-a9e4-dece8bd1b8c7'
        });

        // Utility function to capitalize words
        const capitalizeWords = (str) => {
            return str.split('_').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        };

        // Function to list ROMs
        async function listRoms() {
            try {
                const s3 = new AWS.S3();
                const bucketName = 'ccportedroms';
                const roms = {};

                // List all directories (consoles)
                const { CommonPrefixes } = await s3.listObjects({
                    Bucket: bucketName,
                    Delimiter: '/'
                }).promise();

                // Get ROMs for each console
                for (const prefix of CommonPrefixes) {
                    const consoleType = prefix.Prefix.replace('/', '');
                    const response = await s3.listObjects({
                        Bucket: bucketName,
                        Prefix: prefix.Prefix
                    }).promise();

                    roms[consoleType] = response.Contents
                        .filter(item => item.Key !== prefix.Prefix)
                        .map(item => {
                            const fileName = item.Key.split('/').pop();
                            return [
                                fileName,
                                capitalizeWords(fileName.split('.')[0])
                            ];
                        });
                }

                displayRoms(roms);
            } catch (error) {
                console.error('Error loading ROMs:', error);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        Error loading ROMs. Please try again later.
                        <br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // Function to display ROMs
        function displayRoms(roms) {
            const content = document.getElementById('content');
            content.innerHTML = Object.entries(roms)
                .map(([console, romList]) => `
                    <div class="console-section">
                        <h2 class="console-title">${console.toUpperCase()}</h2>
                        <ul class="rom-list">
                            ${romList.map(([filename, title]) => `
                                <li class="rom-item">
                                    ${title}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `).join('');
        }

        // Initialize AWS credentials and load ROMs
        AWS.config.credentials.get(function(err) {
            if (err) {
                console.error('Error getting AWS credentials:', err);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        Error initializing AWS credentials.
                        <br>
                        ${err.message}
                    </div>
                `;
                return;
            }
            listRoms();
        });
    </script>
</body>
</html>